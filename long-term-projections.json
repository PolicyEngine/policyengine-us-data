{"version":3,"kind":"Notebook","sha256":"a6b2a973fcfdb9c4eec6066f9249f2e6d681f4e9b45967962693ea09b5690209","slug":"long-term-projections","location":"/long_term_projections.ipynb","dependencies":[],"frontmatter":{"title":"Long Term Projections","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"given":"PolicyEngine","family":"Team","literal":"PolicyEngine Team"},"name":"PolicyEngine Team","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/policyengine/policyengine-us-data","copyright":"2024","source_url":"https://github.com/policyengine/policyengine-us-data/blob/main/docs/long_term_projections.ipynb","edit_url":"https://github.com/policyengine/policyengine-us-data/edit/main/docs/long_term_projections.ipynb","exports":[{"format":"ipynb","filename":"long_term_projections.ipynb","url":"/policyengine-us-data/build/long_term_projection-1327a34ae5e18584a2084d963d034a80.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Integrating Economic Uprating with Demographic Reweighting","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"U1nPvGR5AN"}],"identifier":"integrating-economic-uprating-with-demographic-reweighting","label":"Integrating Economic Uprating with Demographic Reweighting","html_id":"integrating-economic-uprating-with-demographic-reweighting","implicit":true,"key":"hiGVacVVB3"}],"key":"N5yc8uy0Ut"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Executive Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"D3awzZRHFJ"}],"identifier":"executive-summary","label":"Executive Summary","html_id":"executive-summary","implicit":true,"key":"dGvG1vxwB3"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This document outlines an innovative approach for projecting federal income tax revenue through 2100 that uniquely combines sophisticated economic microsimulation with demographic reweighting. By harmonizing PolicyEngine’s state-of-the-art tax modeling with Social Security Administration demographic projections, we can isolate and quantify the fiscal impact of population aging while preserving the full complexity of the tax code.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sSSZEtDfmB"}],"key":"lnkiyW9vv6"}],"key":"J2ZQxwVbHx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The Challenge","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Mo02Ci9W4D"}],"identifier":"the-challenge","label":"The Challenge","html_id":"the-challenge","implicit":true,"key":"H1zUPTdw3T"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Projecting tax revenue over a 75-year horizon requires simultaneously modeling two distinct but interrelated dynamics:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cvMZ7Rt5hF"}],"key":"scfaxd3XGh"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Economic Evolution","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ndELGeF6Oe"}],"key":"zXzo11xtK3"},{"type":"text","value":": How incomes, prices, and tax parameters change over time","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DPopWpM5op"}],"key":"SPNvo3Ulet"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Wage growth and income distribution shifts","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xSmYayxEzA"}],"key":"mFJ44s533N"}],"key":"uSF4FWDtit"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Inflation affecting brackets and deductions","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"wO8HBWCl4G"}],"key":"o6GF89amh2"}],"key":"Qa8n2p5Mpm"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Legislative changes and indexing rules","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"xNABgTYA6W"}],"key":"AN4UX5oS6P"}],"key":"gCE9lyBt87"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Behavioral responses to tax policy","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"EZ2NXCAnhi"}],"key":"zYAn1EoExQ"}],"key":"ttKYjFehBG"}],"key":"NHPa62MZKi"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Demographic Transformation","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Bv2HqsmdRM"}],"key":"gFQo4eB5Ar"},{"type":"text","value":": How the population structure evolves","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"cAKH4vArLI"}],"key":"FO3Q8Noaoe"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Baby boom generation aging through retirement","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"sBkaZz5GBb"}],"key":"MQxDr3W5UY"}],"key":"bxALY9j1VT"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Declining birth rates reducing working-age population","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"BbrJzOQ8Re"}],"key":"QpRjudnj8g"}],"key":"YpUoe3RHuD"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Increasing longevity extending retirement duration","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"PyrQSbt3CJ"}],"key":"OW5WRp8iZ4"}],"key":"l6jkNM8S7d"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Shifting household composition patterns","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"QvHByOQQsO"}],"key":"e8owrN0G4O"}],"key":"KTQsLwWV3V"}],"key":"b4hhaQQMmZ"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Traditional approaches typically sacrifice either economic sophistication (using simplified tax calculations) or demographic realism (holding age distributions constant). Our methodology preserves both.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"QR3o9TZ4zt"}],"key":"VLfdMurRyM"}],"key":"rPyWFhrmSI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Run projections using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dn5rMOxo2A"},{"type":"inlineCode","value":"run_household_projection.py","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Y7SW0Surev"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nIRQI2DBta"}],"key":"ABYCyso9ta"}],"key":"GGQ6IwssLD"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-11-19T19:56:10.232617Z","iopub.status.busy":"2025-11-19T19:56:10.232523Z","iopub.status.idle":"2025-11-19T19:57:25.892674Z","shell.execute_reply":"2025-11-19T19:57:25.892382Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Save calibrated datasets as .h5 files for each year\n!python ../policyengine_us_data/datasets/cps/long_term/run_household_projection.py 2027 --greg --use-ss --use-payroll --save-h5","key":"S35BO4Timm"},{"type":"outputs","id":"Izkq__7-GlKBz6drzF9M1","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"TEST_LITE == False\r\n"},"children":[],"key":"jLoFyOijBx"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"======================================================================\r\nHOUSEHOLD-LEVEL INCOME TAX PROJECTION: 2025-2027\r\n======================================================================\r\n\r\nConfiguration:\r\n  Base year: 2024 (CPS microdata)\r\n  Projection: 2025-2027\r\n  Calculation level: HOUSEHOLD ONLY (simplified)\r\n  Calibration method: GREG\r\n  Including Social Security benefits constraint: Yes\r\n  Including taxable payroll constraint: Yes\r\n  Saving year-specific .h5 files: Yes (to ./projected_datasets/)\r\n  Years to process: 3\r\n  Estimated time: ~9 minutes\r\n\r\n======================================================================\r\nSTEP 1: DEMOGRAPHIC PROJECTIONS\r\n======================================================================\r\n\r\nLoaded SSA projections: 86 ages x 3 years\r\n\r\nPopulation projections:\r\n  2025:  346.6M\r\n  2027:  350.9M\r\n\r\n======================================================================\r\nSTEP 2: BUILDING HOUSEHOLD AGE COMPOSITION\r\n======================================================================\r\n"},"children":[],"key":"mPIYMfPwzL"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"\r\nLoaded 21,532 households\r\nHousehold age matrix shape: (21532, 86)\r\n"},"children":[],"key":"bjTl1YFtbn"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"\r\n======================================================================\r\nSTEP 3: HOUSEHOLD-LEVEL PROJECTION\r\n======================================================================\r\n\r\nMethodology (SIMPLIFIED):\r\n  1. PolicyEngine uprates to each projection year\r\n  2. Calculate all values at household level (map_to='household')\r\n  3. IPF/GREG adjusts weights to match SSA demographics\r\n  4. Apply calibrated weights directly (no aggregation needed)\r\n\r\nInitial memory usage: 1.13 GB\r\n\r\nYear    Population    Income Tax    Baseline Tax    Memory\r\n-----------------------------------------------------------------\r\n"},"children":[],"key":"LMx69HigYO"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"  [DEBUG 2025] SS baseline: $1424.6B, target: $1609.0B\r\n  [DEBUG 2025] Payroll baseline: $8950.9B, target: $10621.0B\r\n"},"children":[],"key":"oGJvqVkwVp"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"  [DEBUG 2025] SS achieved: $1609.0B (error: -0.0%)\r\n  [DEBUG 2025] Payroll achieved: $10621.0B (error: -0.0%)\r\n"},"children":[],"key":"Rg62I1f4Nf"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"  Saved 2025.h5\r\n"},"children":[],"key":"WTqmgATzYX"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"2025      346.6M     $ 2543.1B     $ 1882.9B     4.32GB\r\n"},"children":[],"key":"lSdTMDJvOC"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"  [DEBUG 2027] SS baseline: $1495.1B, target: $1799.9B\r\n  [DEBUG 2027] Payroll baseline: $9718.4B, target: $11627.0B\r\n"},"children":[],"key":"docXa1mRT0"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"  [DEBUG 2027] SS achieved: $1799.9B (error: -0.0%)\r\n  [DEBUG 2027] Payroll achieved: $11627.0B (error: 0.0%)\r\n"},"children":[],"key":"QLlRp2PY1y"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"  Saved 2027.h5\r\n"},"children":[],"key":"cywzHyfoXj"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"2027      350.9M     $ 2873.8B     $ 2125.0B     4.62GB\r\n"},"children":[],"key":"mcJDflTqyl"}],"key":"LhnF4Y6WP6"}],"key":"edySLWi87J"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Arguments:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bgmpDwpCr8"}],"key":"lhwlFd70Qf"}],"key":"mS1UEvLeVH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"END_YEAR","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"PSnaA1gXdi"},{"type":"text","value":": Target year for projection (default: 2035)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"dc4G3nzkz0"}],"key":"raEQmOBHl3"}],"key":"TL0TKbiHPW"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"--greg","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sD2u0HmCkL"},{"type":"text","value":": Use GREG calibration instead of IPF (optional)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cUG5gxyoYt"}],"key":"b56U2djENc"}],"key":"uHgn8a9Gl2"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"--use-ss","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Vlf0q2Is6H"},{"type":"text","value":": Include Social Security benefit totals as calibration target (requires --greg)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"VjjzS9mxno"}],"key":"lu7kHe6p0f"}],"key":"OvsKGXF5fk"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"--use-payroll","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JWeGfNyCGn"},{"type":"text","value":": Include taxable payroll as calibration target (requires --greg)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"W3QRUrlJfE"}],"key":"tmKGOp3gzr"}],"key":"D7ayuqR1yA"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"--save-h5","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Enji7kwSQb"},{"type":"text","value":": Save year-specific .h5 files to ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"OcjrLE4OzB"},{"type":"inlineCode","value":"./projected_datasets/","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"kAGHOZ6jMx"},{"type":"text","value":" directory","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"X7NXwcb1Um"}],"key":"uLdANg2dFk"}],"key":"AgN6LCaUKm"}],"key":"FDKU5MiAXf"}],"key":"htGEspM803"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The Challenge","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"u7AydMZ8Eb"}],"identifier":"the-challenge","label":"The Challenge","html_id":"the-challenge-1","implicit":true,"key":"irnmx9Rj91"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Projecting tax revenue over a 75-year horizon requires simultaneously modeling two distinct but interrelated dynamics:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fNcvzmsvH9"}],"key":"zCCcMWiJof"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Economic Evolution","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vQjs9GBH62"}],"key":"MPFSh4G7ND"},{"type":"text","value":": How incomes, prices, and tax parameters change over time","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ck4euTroMm"}],"key":"RsFRIGIkGw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Wage growth and income distribution shifts","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"PSFrQnhUdr"}],"key":"jdSG7yzYsA"}],"key":"WrjVick6of"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Inflation affecting brackets and deductions","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"gfJTzBpZsY"}],"key":"S5V5Z4SwBT"}],"key":"MQVmDfkivB"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Legislative changes and indexing rules","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"y2hK71b3vq"}],"key":"SAYlVEMGAI"}],"key":"WWnfZgRrIR"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Behavioral responses to tax policy","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"EB0BxyPHTG"}],"key":"swWs5lQGzA"}],"key":"Jd722LUoAd"}],"key":"sGGNfs8VQ5"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Demographic Transformation","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"UPG2pK00jF"}],"key":"kkzr0f1kgn"},{"type":"text","value":": How the population structure evolves","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"if3L6d7LE9"}],"key":"o9ptaBcWwx"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Baby boom generation aging through retirement","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"RQGGd4F4dn"}],"key":"W0At4J2wPZ"}],"key":"xkCnBvEFgj"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Declining birth rates reducing working-age population","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"VjuEX5Rtmb"}],"key":"kUHe66rGYH"}],"key":"CUgGM55qAD"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Increasing longevity extending retirement duration","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"tcENfDCnnS"}],"key":"zG8RLxmAlz"}],"key":"IzD9fZUtfu"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Shifting household composition patterns","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"v9NJUm4o8K"}],"key":"zQzPYewYr6"}],"key":"Amc2BxylQA"}],"key":"wZR1O8tY9F"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Traditional approaches typically sacrifice either economic sophistication (using simplified tax calculations) or demographic realism (holding age distributions constant). Our methodology preserves both.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Abz6Ky0Wk7"}],"key":"QovX3VKfAc"}],"key":"tmQriZQ2Zc"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data Sources","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nSPZ9KurJn"}],"identifier":"data-sources","label":"Data Sources","html_id":"data-sources","implicit":true,"key":"P5W4EdLN8n"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The long-term projections use two key SSA datasets:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yAK1ZmTD95"}],"key":"SycTKyn0gx"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"SSA Population Projections","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"g4MRR5e9FK"}],"key":"IBtuaB5Ln0"},{"type":"text","value":" (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qxzgGXg90N"},{"type":"inlineCode","value":"SSPopJul_TR2024.csv","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JLKXxjuND0"},{"type":"text","value":")","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qPr1iiZFSB"}],"key":"NYrnkbWv7L"}],"key":"OQ1M0kGUro"}],"key":"FZ0m530zaB"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Source: ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"cco7WpDmNb"},{"type":"link","url":"https://www.ssa.gov/oact/HistEst/Population/2024/Population2024.html","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"SSA 2024 Trustees Report - Single Year Age Demographic Projections","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"g4t2S5vD4d"}],"urlSource":"https://www.ssa.gov/oact/HistEst/Population/2024/Population2024.html","key":"TLTW1vx7MJ"}],"key":"OnvKIkTEMq"}],"key":"qgvqS0BEBs"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Contains age-specific population projections through 2100","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"e3F5XgzS8T"}],"key":"PvX38evvkQ"}],"key":"voWGV5T885"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Used for demographic reweighting to match future population structure","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"pR2LELylL3"}],"key":"AhkrnmpxzQ"}],"key":"hCsA9zXZJz"}],"key":"wnXC6nasib"},{"type":"list","ordered":true,"start":2,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Social Security Cost Projections","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"sTGw19tJAg"}],"key":"y3PujtWir2"},{"type":"text","value":" (","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"wNpzHAZh6A"},{"type":"inlineCode","value":"social_security_aux.csv","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"bHjZeel5Ov"},{"type":"text","value":")","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"TJ4htVXMDF"}],"key":"UDHRMLd6Dd"}],"key":"LgGPWh9E5F"}],"key":"Nv2UMua2Mo"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Source: ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"aLt9UfJQIB"},{"type":"link","url":"https://www.ssa.gov/oact/TR/2025/index.html","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"SSA 2025 Trustees Report, Table VI.G9","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"wooThzFjZ9"}],"urlSource":"https://www.ssa.gov/oact/TR/2025/index.html","key":"SevkL4TlO2"}],"key":"L3NqOnbZUc"}],"key":"bDLxZMGrOL"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Contains OASDI benefit cost projections in CPI-indexed 2025 dollars","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"yzXtt3dQo6"}],"key":"QnrqBI5UvI"}],"key":"n3vNzbdutf"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Used as calibration target in GREG method to ensure fiscal consistency","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"tzsfRrniHR"}],"key":"kxMakrBzxM"}],"key":"Emry6yKFwb"}],"key":"hMFizJBAUC"}],"key":"shy1PdZDhU"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-11-19T19:57:25.894248Z","iopub.status.busy":"2025-11-19T19:57:25.894165Z","iopub.status.idle":"2025-11-19T19:57:28.259561Z","shell.execute_reply":"2025-11-19T19:57:28.259297Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom pathlib import Path\n\nfrom policyengine_us_data.storage import STORAGE_FOLDER","key":"JygfHVMngQ"},{"type":"outputs","id":"e4LjTahXhlk_Zr8L2iv1w","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/home/baogorek/envs/pe/lib/python3.13/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n  from .autonotebook import tqdm as notebook_tqdm\n"},"children":[],"key":"P4sHhs1ZzR"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"TEST_LITE == False\n"},"children":[],"key":"ixFYpirLnx"}],"key":"RxHygsA2s2"}],"key":"fACQunu7BJ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-11-19T19:57:28.260599Z","iopub.status.busy":"2025-11-19T19:57:28.260502Z","iopub.status.idle":"2025-11-19T19:57:28.275248Z","shell.execute_reply":"2025-11-19T19:57:28.275040Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Load SSA population data\nssa_pop = pd.read_csv(STORAGE_FOLDER / 'SSPopJul_TR2024.csv')\nssa_pop.head()","key":"WPJaBJ5yoR"},{"type":"outputs","id":"UPtdIMn9KEFPgvo8I4JIO","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Year</th>\n      <th>Age</th>\n      <th>Total</th>\n      <th>M Tot</th>\n      <th>M Sin</th>\n      <th>M Mar</th>\n      <th>M Wid</th>\n      <th>M Div</th>\n      <th>F Tot</th>\n      <th>F Sin</th>\n      <th>F Mar</th>\n      <th>F Wid</th>\n      <th>F Div</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1941</td>\n      <td>0</td>\n      <td>2492508</td>\n      <td>1276328</td>\n      <td>1276328</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1216180</td>\n      <td>1216180</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1941</td>\n      <td>1</td>\n      <td>2384290</td>\n      <td>1218524</td>\n      <td>1218524</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1165766</td>\n      <td>1165766</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1941</td>\n      <td>2</td>\n      <td>2445054</td>\n      <td>1246078</td>\n      <td>1246078</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1198976</td>\n      <td>1198976</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1941</td>\n      <td>3</td>\n      <td>2395999</td>\n      <td>1219543</td>\n      <td>1219543</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1176456</td>\n      <td>1176456</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1941</td>\n      <td>4</td>\n      <td>2275425</td>\n      <td>1157612</td>\n      <td>1157612</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1117813</td>\n      <td>1117813</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"   Year  Age    Total    M Tot    M Sin  M Mar  M Wid  M Div    F Tot  \\\n0  1941    0  2492508  1276328  1276328      0      0      0  1216180   \n1  1941    1  2384290  1218524  1218524      0      0      0  1165766   \n2  1941    2  2445054  1246078  1246078      0      0      0  1198976   \n3  1941    3  2395999  1219543  1219543      0      0      0  1176456   \n4  1941    4  2275425  1157612  1157612      0      0      0  1117813   \n\n     F Sin  F Mar  F Wid  F Div  \n0  1216180      0      0      0  \n1  1165766      0      0      0  \n2  1198976      0      0      0  \n3  1176456      0      0      0  \n4  1117813      0      0      0  ","content_type":"text/plain"}}},"children":[],"key":"bruWrtBzJJ"}],"key":"SwINZAqsWy"}],"key":"xO0yDcF3Pz"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-11-19T19:57:28.276266Z","iopub.status.busy":"2025-11-19T19:57:28.276171Z","iopub.status.idle":"2025-11-19T19:57:28.280120Z","shell.execute_reply":"2025-11-19T19:57:28.279840Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Load Social Security auxiliary data\nss_aux = pd.read_csv(STORAGE_FOLDER / 'social_security_aux.csv')\nss_aux.head()","key":"f6Rh9mQ6fe"},{"type":"outputs","id":"ihMYNl33IXcWH_hT0XX4h","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>year</th>\n      <th>oasdi_cost_in_billion_2025_usd</th>\n      <th>cpi_w_intermediate</th>\n      <th>oasdi_cost_in_billion_nominal_usd</th>\n      <th>taxable_payroll_in_billion_nominal_usd</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2025</td>\n      <td>1609</td>\n      <td>100.00</td>\n      <td>1609.0000</td>\n      <td>10621.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2026</td>\n      <td>1660</td>\n      <td>102.49</td>\n      <td>1701.3340</td>\n      <td>11129.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2027</td>\n      <td>1715</td>\n      <td>104.95</td>\n      <td>1799.8925</td>\n      <td>11627.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2028</td>\n      <td>1763</td>\n      <td>107.47</td>\n      <td>1894.6961</td>\n      <td>12159.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2029</td>\n      <td>1810</td>\n      <td>110.05</td>\n      <td>1991.9050</td>\n      <td>12696.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"   year  oasdi_cost_in_billion_2025_usd  cpi_w_intermediate  \\\n0  2025                            1609              100.00   \n1  2026                            1660              102.49   \n2  2027                            1715              104.95   \n3  2028                            1763              107.47   \n4  2029                            1810              110.05   \n\n   oasdi_cost_in_billion_nominal_usd  taxable_payroll_in_billion_nominal_usd  \n0                          1609.0000                                 10621.0  \n1                          1701.3340                                 11129.0  \n2                          1799.8925                                 11627.0  \n3                          1894.6961                                 12159.0  \n4                          1991.9050                                 12696.0  ","content_type":"text/plain"}}},"children":[],"key":"CuATIxD2es"}],"key":"TRYpEQTfmn"}],"key":"GsnRzrxG1U"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Core Innovation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ibKZeata76"}],"identifier":"core-innovation","label":"Core Innovation","html_id":"core-innovation","implicit":true,"key":"aJggSSnGRl"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Our approach operates in two complementary stages:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yEWv61ULn6"}],"key":"H54j8OA4zQ"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Stage 1: Economic Uprating","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fGHmePHD8j"}],"identifier":"stage-1-economic-uprating","label":"Stage 1: Economic Uprating","html_id":"stage-1-economic-uprating","implicit":true,"key":"qfr6gb7H69"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"PolicyEngine’s microsimulation engine projects each household’s economic circumstances forward using:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Jm66Kizdl9"}],"key":"AkXtGeSTXG"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Sophisticated Income Modeling","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"eewhyYEXhD"}],"key":"fRYpRjOdMf"}],"key":"YheX0xklvY"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"The system models 17 distinct income categories, each uprated according to its economic fundamentals:","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"HGO234UsXB"}],"key":"huOcjQ7TFR"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Primary Categories with Specific Projections:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"tRAg8n3MFh"}],"key":"zMEoHhitfu"}],"key":"dz49ma2SeS"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Employment income (wages) - follows CBO wage growth projections","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"dHMdLu9fGQ"}],"key":"x3fe7Nenrt"}],"key":"hZTDdiLiYK"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Self-employment income - follows CBO business income projections","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"WL44u3weas"}],"key":"yqzJ41qTMa"}],"key":"lq2ehcA30E"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Capital gains - follows CBO asset appreciation projections","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"pIrWSsbrRE"}],"key":"x2nrgz8iuT"}],"key":"lzvhZGrDiv"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Interest income - follows CBO interest rate projections","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"hqqRXALdSc"}],"key":"zfbAcqnlep"}],"key":"enB56G9juL"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Dividend income - follows CBO corporate profit projections","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"TSZI15dgLc"}],"key":"xhZM1X7CdI"}],"key":"qIBJjdjkHd"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Pension income - follows CBO retirement income projections","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"mZXw9A3cf2"}],"key":"dBmt6UcVwz"}],"key":"LBI9v3Ffh2"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Social Security - follows SSA COLA projections (available through 2100)","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Xa4BrAZkKp"}],"key":"CPm8pEthvi"}],"key":"bj47sNG1v0"}],"key":"yrt9qCAEhA"}],"key":"vtjuoFwTFo"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Stage 2: Demographic Reweighting","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NqNUleopjx"}],"identifier":"stage-2-demographic-reweighting","label":"Stage 2: Demographic Reweighting","html_id":"stage-2-demographic-reweighting","implicit":true,"key":"uFTNkuUEGH"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We offer two calibration methods for adjusting household weights to match SSA projections:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VQk7V76pMO"}],"key":"Lr40F0Kkf8"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Method 1: Iterative Proportional Fitting (IPF)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ANkHTEsj5f"}],"key":"HtCvbUH12I"}],"key":"iwDp4fTFQA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Traditional raking approach using Kullback-Leibler divergence","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"fKUmfpWU8p"}],"key":"YpaemUeCsw"}],"key":"uxEWNv9TSl"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Iteratively adjusts weights to match marginal distributions","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xB1FfBBVOL"}],"key":"jDrWgRJdTz"}],"key":"X3ROCjtxPQ"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Robust to specification and always produces non-negative weights","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"wZ79hZuYoy"}],"key":"FDU6LSzbP6"}],"key":"KYl8EBqScW"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Default method for backward compatibility","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Qg4MCkNX1N"}],"key":"XjNmL1nMti"}],"key":"uvkHkLTuCF"}],"key":"ZNNhxZu2KP"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Method 2: Generalized Regression (GREG) Calibration","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"nK928BRovJ"}],"key":"fTsw7tO8nm"}],"key":"bA1jQWIeXo"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Modern calibration using chi-squared distance minimization","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"saOTkGd5kT"}],"key":"eGOPvc3RuA"}],"key":"LWt4bed2D2"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Enables simultaneous calibration to categorical AND continuous variables","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"tvntRERBrW"}],"key":"gy4xcKEGB9"}],"key":"VgW7GmwV6R"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Direct solution via matrix operations (no iteration needed)","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"sO04iTahAI"}],"key":"W65NTy291p"}],"key":"nxBvCalLWm"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Required for incorporating Social Security benefit constraints","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"RxH5QDHO3U"}],"key":"qviGAcwRvZ"}],"key":"ZlKgngztQW"}],"key":"RuJPmUJfRD"}],"key":"uHYelWOmLo"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Demonstrating the Calibration Methods","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DprkNsrpQJ"}],"identifier":"demonstrating-the-calibration-methods","label":"Demonstrating the Calibration Methods","html_id":"demonstrating-the-calibration-methods","implicit":true,"key":"RxfOoNKjNh"}],"key":"AjsHVofoqp"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-11-19T19:57:28.280998Z","iopub.status.busy":"2025-11-19T19:57:28.280918Z","iopub.status.idle":"2025-11-19T19:57:28.282636Z","shell.execute_reply":"2025-11-19T19:57:28.282472Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from policyengine_us_data.datasets.cps.long_term.ssa_data import (\n    load_ssa_age_projections,\n    load_ssa_benefit_projections\n)","key":"vDMQVaGvGb"},{"type":"outputs","id":"Jvio4KwZuIHDoxqJ4I1aS","children":[],"key":"ITCnH5oIPk"}],"key":"OC242gDWMO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-11-19T19:57:28.283285Z","iopub.status.busy":"2025-11-19T19:57:28.283217Z","iopub.status.idle":"2025-11-19T19:57:28.296829Z","shell.execute_reply":"2025-11-19T19:57:28.296600Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Get SSA population targets for a specific year\nyear = 2025\nage_targets = load_ssa_age_projections(end_year=year)\nprint(f\"\\nAge distribution targets for {year}:\")\nprint(f\"Shape: {age_targets.shape}\")\nprint(f\"Total population: {age_targets[:, 0].sum() / 1000:.1f}M\")","key":"C8cJSRRZa5"},{"type":"outputs","id":"V4QxWMHioGy4fAmqbkcNl","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"\nAge distribution targets for 2025:\nShape: (86, 1)\nTotal population: 346577.3M\n"},"children":[],"key":"NWWpoWLKeg"}],"key":"p9xcVsnClp"}],"key":"iazzzzoPxb"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-11-19T19:57:28.297698Z","iopub.status.busy":"2025-11-19T19:57:28.297611Z","iopub.status.idle":"2025-11-19T19:57:28.300109Z","shell.execute_reply":"2025-11-19T19:57:28.299938Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Get Social Security benefit target\nss_target = load_ssa_benefit_projections(year)\nprint(f\"\\nSocial Security benefit target for {year}: ${ss_target / 1e9:.1f}B\")","key":"LBypVUL3p1"},{"type":"outputs","id":"VBmo6pjq4z5OpHAJCbeGu","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"\nSocial Security benefit target for 2025: $1609.0B\n"},"children":[],"key":"DrF12m1MCc"}],"key":"pJ7Rj0mrgz"}],"key":"FHmKzaMxVt"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"PWBM Analysis: Eliminating Income Taxes on Social Security Benefits","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aMHYqMBNJy"}],"identifier":"pwbm-analysis-eliminating-income-taxes-on-social-security-benefits","label":"PWBM Analysis: Eliminating Income Taxes on Social Security Benefits","html_id":"pwbm-analysis-eliminating-income-taxes-on-social-security-benefits","implicit":true,"key":"jcNLrhTE1B"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Source:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bbAeksnXz5"}],"key":"z9Ashp6r4E"},{"type":"text","value":" ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"a43h4dsY0d"},{"type":"link","url":"https://budgetmodel.wharton.upenn.edu/issues/2025/2/10/eliminating-income-taxes-on-social-security-benefits","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Eliminating Income Taxes on Social Security Benefits","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sde0PlJ2vN"}],"urlSource":"https://budgetmodel.wharton.upenn.edu/issues/2025/2/10/eliminating-income-taxes-on-social-security-benefits","key":"YgWIUWJ8So"},{"type":"text","value":" (Penn Wharton Budget Model, February 10, 2025)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eGbi2T1rDV"}],"key":"yHXIr3EKR3"},{"type":"thematicBreak","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uYEvF6b8HY"},{"type":"heading","depth":4,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Policy Analyzed","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GSF0twienX"}],"identifier":"policy-analyzed","label":"Policy Analyzed","html_id":"policy-analyzed","implicit":true,"key":"MgbFrCP2yr"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"The Penn Wharton Budget Model (PWBM) analyzed a policy proposal to permanently eliminate all income taxes on Social Security benefits, effective January 1, 2025.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"CwxsHvgkqJ"}],"key":"leCAoLILZn"},{"type":"heading","depth":4,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Key Findings","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"oB16dnx8eF"}],"identifier":"key-findings","label":"Key Findings","html_id":"key-findings","implicit":true,"key":"MQbp0Wdicx"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Budgetary Impact:","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"LVvmTSVOfs"}],"key":"rHCZzc8uyy"},{"type":"text","value":" The policy is projected to reduce federal revenues by ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"RI5Ohaxb0O"},{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"$1.45 trillion","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"xz52Mm0QOB"}],"key":"RfQkcrTt8V"},{"type":"text","value":" over the 10-year budget window (2025-2034). Over the long term, it is projected to increase federal debt by 7 percent by 2054, relative to the current baseline.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"mGv4W2ilg6"}],"key":"EQsol5zf1X"}],"key":"FWxQs15nVK"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Macroeconomic Impact:","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"giR7OaYBkA"}],"key":"D6YL3CgMCO"},{"type":"text","value":" The analysis finds the policy would have negative long-term effects on the economy.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"cK40wBQuR9"}],"key":"wSQmYqA10x"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It reduces incentives for households to save for retirement and to work.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"P6yRNTGKvw"}],"key":"uw2n3oSQ0b"}],"key":"K0VuERc9G0"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This leads to a smaller capital stock (projected to be 4.2% lower by 2054).","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"eOzu8RcL64"}],"key":"dHqhLXVijZ"}],"key":"X9RNA9cMji"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The smaller capital stock results in lower average wages (1.8% lower by 2054) and lower GDP (2.1% lower by 2054).","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"bHs66OIBsq"}],"key":"KYet3nyTVI"}],"key":"dzTkuUHmWN"}],"key":"mecY4dYzDv"}],"key":"irRCCcl13x"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Conventional Distributional Impact (Your Table):","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"fpftl7n6rU"}],"key":"Q8W3tufgG0"},{"type":"text","value":" The table you shared shows the annual “conventional” effects on household after-tax income.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"ChTlMGfiyo"}],"key":"aXrpIjiSTF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The largest average ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"U0fIoKkVfQ"},{"type":"emphasis","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"dollar","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"siY7ICLW08"}],"key":"c1VUIICdnb"},{"type":"text","value":" tax cuts go to households in the top 20 percent of the income distribution (quintiles 80-100%).","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"ylkBVMif8S"}],"key":"eJ3rdQJRT2"}],"key":"pEjgllqtCT"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The largest ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"xlD2kObkIN"},{"type":"emphasis","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"relative","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"d8mTZ0kh12"}],"key":"yANncRMXqi"},{"type":"text","value":" gains (as a percentage of income) go to households in the fourth quintile (60-80%), who see a 1.6% increase in after-tax income by 2054.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"qpN8mLFiyg"}],"key":"nu3KcuuvQP"}],"key":"kpDzx4MYcy"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The dollar amounts shown are in ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"gaViGCE3cl"},{"type":"strong","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"nominal dollars","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"XNb8pylErO"}],"key":"lEcLXIbd5R"},{"type":"text","value":" for each specified year, not adjusted to a single base year.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"huFFmLSzPi"}],"key":"gPOOWlslIC"}],"key":"K3sjF9LOyH"}],"key":"qJgi6gD6kN"}],"key":"cye01e8AR6"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"strong","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Dynamic (Lifetime) Impact:","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"NUrU71DWLb"}],"key":"SfjYqcuUjd"},{"type":"text","value":" When analyzing the policy’s effects over a household’s entire lifetime, PWBM finds:","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"b1clx5xGVG"}],"key":"M6duH1Ot7p"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The policy primarily benefits high-income households who are nearing or in retirement.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"YBc7rfNkTm"}],"key":"JE4rA7YBTA"}],"key":"ihTwYWHGp6"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It negatively impacts all households under the age of 30 and all future generations, who would experience a net welfare loss due to the long-term effects of lower wages and higher federal debt.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"IVPTOHJVci"}],"key":"IwCgRHL5x5"}],"key":"Do1nzIz3TF"}],"key":"l0VzMnstMp"}],"key":"kAInXritGK"}],"key":"ipYqHnDnnW"}],"key":"UaFY9FKt0N"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"PolicyEngine’s Analysis of Eliminating Income Taxes on Social Security Benefits","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RRoVE6LJv0"}],"identifier":"policyengines-analysis-of-eliminating-income-taxes-on-social-security-benefits","label":"PolicyEngine’s Analysis of Eliminating Income Taxes on Social Security Benefits","html_id":"policyengines-analysis-of-eliminating-income-taxes-on-social-security-benefits","implicit":true,"key":"zH2i5ELctY"}],"key":"r84CCzirQj"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-11-19T19:57:28.300920Z","iopub.status.busy":"2025-11-19T19:57:28.300844Z","iopub.status.idle":"2025-11-19T19:59:04.747344Z","shell.execute_reply":"2025-11-19T19:59:04.747122Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"import sys\nimport os\nimport pandas as pd\nimport numpy as np\nimport gc\n\nfrom policyengine_us import Microsimulation\nfrom policyengine_core.reforms import Reform\n\nWHARTON_BENCHMARKS = {\n    2026: {\n        'First quintile': {'tax_change': 0, 'pct_change': 0.0},\n        'Second quintile': {'tax_change': -15, 'pct_change': 0.0},\n        'Middle quintile': {'tax_change': -340, 'pct_change': 0.5},\n        'Fourth quintile': {'tax_change': -1135, 'pct_change': 1.1},\n        '80-90%': {'tax_change': -1625, 'pct_change': 1.0},\n        '90-95%': {'tax_change': -1590, 'pct_change': 0.7},\n        '95-99%': {'tax_change': -2020, 'pct_change': 0.5},\n        '99-99.9%': {'tax_change': -2205, 'pct_change': 0.2},\n        'Top 0.1%': {'tax_change': -2450, 'pct_change': 0.0},\n    },\n    2034: {\n        'First quintile': {'tax_change': 0, 'pct_change': 0.0},\n        'Second quintile': {'tax_change': -45, 'pct_change': 0.1},\n        'Middle quintile': {'tax_change': -615, 'pct_change': 0.8},\n        'Fourth quintile': {'tax_change': -1630, 'pct_change': 1.2},\n        '80-90%': {'tax_change': -2160, 'pct_change': 1.1},\n        '90-95%': {'tax_change': -2160, 'pct_change': 0.7},\n        '95-99%': {'tax_change': -2605, 'pct_change': 0.6},\n        '99-99.9%': {'tax_change': -2715, 'pct_change': 0.2},\n        'Top 0.1%': {'tax_change': -2970, 'pct_change': 0.0},\n    },\n    2054: {\n        'First quintile': {'tax_change': -5, 'pct_change': 0.0},\n        'Second quintile': {'tax_change': -275, 'pct_change': 0.3},\n        'Middle quintile': {'tax_change': -1730, 'pct_change': 1.3},\n        'Fourth quintile': {'tax_change': -3560, 'pct_change': 1.6},\n        '80-90%': {'tax_change': -4075, 'pct_change': 1.2},\n        '90-95%': {'tax_change': -4385, 'pct_change': 0.9},\n        '95-99%': {'tax_change': -4565, 'pct_change': 0.6},\n        '99-99.9%': {'tax_change': -4820, 'pct_change': 0.2},\n        'Top 0.1%': {'tax_change': -5080, 'pct_change': 0.0},\n    },\n}\n\ndef run_analysis(dataset_path, year, income_rank_var = \"household_net_income\"):\n    \"\"\"Run Option 1 analysis for given dataset and year\"\"\"\n\n    option1_reform = Reform.from_dict(\n        {\n            # Base rate parameters (0-50% bracket)\n            \"gov.irs.social_security.taxability.rate.base.benefit_cap\": {\n                \"2026-01-01.2100-12-31\": 0\n            },\n            \"gov.irs.social_security.taxability.rate.base.excess\": {\n                \"2026-01-01.2100-12-31\": 0\n            },\n            # Additional rate parameters (50-85% bracket)\n            \"gov.irs.social_security.taxability.rate.additional.benefit_cap\": {\n                \"2026-01-01.2100-12-31\": 0\n            },\n            \"gov.irs.social_security.taxability.rate.additional.bracket\": {\n                \"2026-01-01.2100-12-31\": 0\n            },\n            \"gov.irs.social_security.taxability.rate.additional.excess\": {\n                \"2026-01-01.2100-12-31\": 0\n            }\n        }, country_id=\"us\"\n    )\n    reform = Microsimulation(dataset=dataset_path, reform=option1_reform)\n\n    # Get household data\n    household_net_income_reform = reform.calculate(\"household_net_income\", period=year, map_to=\"household\")\n    household_agi_reform = reform.calculate(\"adjusted_gross_income\", period=year, map_to=\"household\")\n    income_tax_reform = reform.calculate(\"income_tax\", period=year, map_to=\"household\")\n\n    del reform\n    gc.collect()\n\n    print(f\"Loading dataset: {dataset_path}\")\n    baseline = Microsimulation(dataset=dataset_path)\n    household_weight = baseline.calculate(\"household_weight\", period=year)\n    household_net_income_baseline = baseline.calculate(\"household_net_income\", period=year, map_to=\"household\")\n    household_agi_baseline = baseline.calculate(\"adjusted_gross_income\", period=year, map_to=\"household\")\n    income_tax_baseline = baseline.calculate(\"income_tax\", period=year, map_to=\"household\")\n\n    # Calculate changes\n    tax_change = income_tax_reform - income_tax_baseline\n    income_change_pct = (\n        (household_net_income_reform - household_net_income_baseline) / household_net_income_baseline\n    ) * 100\n\n    # Create DataFrame\n    df = pd.DataFrame({\n        'household_net_income': household_net_income_baseline,\n        'weight': household_weight,\n        'tax_change': tax_change,\n        'income_change_pct': income_change_pct,\n        'income_rank_var': baseline.calculate(income_rank_var, year, map_to=\"household\")\n    })\n    \n    # Calculate percentiles\n\n    print(f\"Ranking according to quantiles with: {income_rank_var}\")\n    df['income_percentile'] = df['income_rank_var'].rank(pct=True) * 100\n\n    # Assign income groups\n    def assign_income_group(percentile):\n        if percentile <= 20:\n            return 'First quintile'\n        elif percentile <= 40:\n            return 'Second quintile'\n        elif percentile <= 60:\n            return 'Middle quintile'\n        elif percentile <= 80:\n            return 'Fourth quintile'\n        elif percentile <= 90:\n            return '80-90%'\n        elif percentile <= 95:\n            return '90-95%'\n        elif percentile <= 99:\n            return '95-99%'\n        elif percentile <= 99.9:\n            return '99-99.9%'\n        else:\n            return 'Top 0.1%'\n\n    df['income_group'] = df['income_percentile'].apply(assign_income_group)\n\n    # Calculate aggregate revenue\n    revenue_impact = (income_tax_reform.sum() - income_tax_baseline.sum()) / 1e9\n\n    # Calculate by group\n    results = []\n    for group in ['First quintile', 'Second quintile', 'Middle quintile', 'Fourth quintile',\n                  '80-90%', '90-95%', '95-99%', '99-99.9%', 'Top 0.1%']:\n        group_data = df[df['income_group'] == group]\n        if len(group_data) == 0:\n            continue\n\n        total_weight = group_data['weight'].sum()\n        avg_tax_change = (group_data['tax_change'] * group_data['weight']).sum() / total_weight\n        avg_income_change_pct = (group_data['income_change_pct'] * group_data['weight']).sum() / total_weight\n\n        results.append({\n            'group': group,\n            'pe_tax_change': round(avg_tax_change),\n            'pe_pct_change': round(avg_income_change_pct, 1),\n        })\n\n    return pd.DataFrame(results), revenue_impact\n\ndef generate_comparison_table(pe_results, year):\n    \"\"\"Generate comparison table with Wharton benchmark\"\"\"\n\n    if year not in WHARTON_BENCHMARKS:\n        print(f\"Warning: No Wharton benchmark available for year {year}\")\n        return pe_results\n\n    wharton_data = WHARTON_BENCHMARKS[year]\n\n    comparison = []\n    for _, row in pe_results.iterrows():\n        group = row['group']\n        wharton = wharton_data.get(group, {'tax_change': None, 'pct_change': None})\n\n        pe_tax = row['pe_tax_change']\n        wh_tax = wharton['tax_change']\n\n        comparison.append({\n            'Income Group': group,\n            'PolicyEngine': f\"${pe_tax:,}\",\n            'Wharton': f\"${wh_tax:,}\" if wh_tax is not None else 'N/A',\n            'Difference': f\"${(pe_tax - wh_tax):,}\" if wh_tax is not None else 'N/A',\n            'PE %': f\"{row['pe_pct_change']}%\",\n            'Wharton %': f\"{wharton['pct_change']}%\" if wharton['pct_change'] is not None else 'N/A',\n        })\n\n    return pd.DataFrame(comparison)\n\ndataset_path = 'hf://policyengine/test/2054.h5'\nyear = 2054\nincome_rank_variable = \"household_net_income\"\n\nprint(\"=\"*80)\nprint(f\"WHARTON COMPARISON PIPELINE - YEAR {year}\")\nprint(\"=\"*80)\nprint()\n\n# Run analysis\nprint(\"Running PolicyEngine analysis...\")\npe_results, revenue_impact = run_analysis(dataset_path, year, income_rank_variable)\nprint(f\"✓ Analysis complete\")\nprint(f\"  Revenue impact: ${revenue_impact:.1f}B\")\nprint()\n\n# Generate comparison table\nprint(\"Generating comparison table...\")\ncomparison_table = generate_comparison_table(pe_results, year)\n\nprint()\nprint(\"=\"*80)\nprint(f\"COMPARISON TABLE: {year}\")\nprint(\"=\"*80)\nprint()\nprint(\"Average Tax Change (per household):\")\nprint(comparison_table[['Income Group', 'PolicyEngine', 'Wharton', 'Difference']].to_string(index=False))\nprint()\nprint(\"Percent Change in Income:\")\nprint(comparison_table[['Income Group', 'PE %', 'Wharton %']].to_string(index=False))\nprint()","key":"yc0JztCtBk"},{"type":"outputs","id":"hBZHT1OLKdn7t7BLM3Y-Q","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"================================================================================\nWHARTON COMPARISON PIPELINE - YEAR 2054\n================================================================================\n\nRunning PolicyEngine analysis...\n"},"children":[],"key":"pATY1pmE9u"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Loading dataset: hf://policyengine/test/2054.h5\n"},"children":[],"key":"XiqcFz6G1h"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Ranking according to quantiles with: household_net_income\n✓ Analysis complete\n  Revenue impact: $-579.1B\n\nGenerating comparison table...\n\n================================================================================\nCOMPARISON TABLE: 2054\n================================================================================\n\nAverage Tax Change (per household):\n   Income Group PolicyEngine Wharton Difference\n First quintile         $-95     $-5       $-90\nSecond quintile      $-1,054   $-275      $-779\nMiddle quintile      $-2,241 $-1,730      $-511\nFourth quintile      $-4,633 $-3,560    $-1,073\n         80-90%      $-6,737 $-4,075    $-2,662\n         90-95%     $-12,121 $-4,385    $-7,736\n         95-99%      $-8,066 $-4,565    $-3,501\n       99-99.9%      $-7,257 $-4,820    $-2,437\n       Top 0.1%      $-8,615 $-5,080    $-3,535\n\nPercent Change in Income:\n   Income Group                  PE % Wharton %\n First quintile -0.10000000149011612%      0.0%\nSecond quintile    0.800000011920929%      0.3%\nMiddle quintile    1.100000023841858%      1.3%\nFourth quintile    1.399999976158142%      1.6%\n         80-90%    1.399999976158142%      1.2%\n         90-95%   1.7000000476837158%      0.9%\n         95-99%    0.699999988079071%      0.6%\n       99-99.9%  0.30000001192092896%      0.2%\n       Top 0.1%  0.10000000149011612%      0.0%\n\n"},"children":[],"key":"N3dnlL6sB2"}],"key":"HXkEIAQrrA"}],"key":"GHxfrnTwHo"}],"key":"CcoSyAt2Hs"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Local Area Calibration Setup","url":"/local-area-calibration-setup","group":"PolicyEngine US Data"},"next":{"title":"Discussion","url":"/discussion","group":"PolicyEngine US Data"}}},"domain":"http://localhost:3000"}