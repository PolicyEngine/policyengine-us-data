{"version":3,"kind":"Article","sha256":"b1ae43aa6bd60f0ae366a670d093369dc0d4979caf8270a00f25c8dbe067171d","slug":"long-term-projections","location":"/long_term_projections.md","dependencies":[],"frontmatter":{"title":"Long Term Projections","content_includes_title":false,"authors":[{"nameParsed":{"given":"PolicyEngine","family":"Team","literal":"PolicyEngine Team"},"name":"PolicyEngine Team","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/policyengine/policyengine-us-data","copyright":"2024","source_url":"https://github.com/policyengine/policyengine-us-data/blob/main/docs/long_term_projections.md","edit_url":"https://github.com/policyengine/policyengine-us-data/edit/main/docs/long_term_projections.md","exports":[{"format":"md","filename":"long_term_projections.md","url":"/policyengine-us-data/build/long_term_projection-35d286a1b9dde40423bf29ae23971b8b.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Integrating Economic Uprating with Demographic Reweighting","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"lL2HZajOK7"}],"identifier":"integrating-economic-uprating-with-demographic-reweighting","label":"Integrating Economic Uprating with Demographic Reweighting","html_id":"integrating-economic-uprating-with-demographic-reweighting","implicit":true,"key":"riVzbofz3f"},{"type":"heading","depth":2,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Executive Summary","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"BGDUyX3jaW"}],"identifier":"executive-summary","label":"Executive Summary","html_id":"executive-summary","implicit":true,"key":"Wdjh8kVMol"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"This document outlines an innovative approach for projecting federal income tax revenue through 2100 that uniquely combines sophisticated economic microsimulation with demographic reweighting. By harmonizing PolicyEngine’s state-of-the-art tax modeling with Social Security Administration demographic projections, we can isolate and quantify the fiscal impact of population aging while preserving the full complexity of the tax code.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"tRA0mtee2B"}],"key":"y6REqeakep"},{"type":"heading","depth":2,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"The Challenge","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"sSzKXO70db"}],"identifier":"the-challenge","label":"The Challenge","html_id":"the-challenge","implicit":true,"key":"c9x1dXTrnn"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Projecting tax revenue over a 75-year horizon requires simultaneously modeling two distinct but interrelated dynamics:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"EJavA7koHz"}],"key":"CM42TAF8ya"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Economic Evolution","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"jy65VgDq8R"}],"key":"sPumziJUl8"},{"type":"text","value":": How incomes, prices, and tax parameters change over time","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"YVEPrcVGDE"}],"key":"UD9pvE6aTl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Wage growth and income distribution shifts","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Zebc9LWa4D"}],"key":"AG6A3Ufcjm"}],"key":"x9lAbpsa7F"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Inflation affecting brackets and deductions","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"d9ZNqgMmyY"}],"key":"RBOMDAb70A"}],"key":"Bzf8wAGfM5"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Legislative changes and indexing rules","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"OBMmJmSCeA"}],"key":"YkyNnYKlgh"}],"key":"Ff3aswDSHh"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Behavioral responses to tax policy","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"PQk2hA2sC8"}],"key":"ZfefnUTo5h"}],"key":"FR7ZkbckUm"}],"key":"gzXSV7v5S2"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Demographic Transformation","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"J0JXFNuZg7"}],"key":"qPoVQvhci3"},{"type":"text","value":": How the population structure evolves","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"jE5sexaYRZ"}],"key":"pQFTofOcMG"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":19,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Baby boom generation aging through retirement","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"IArgMVdmdQ"}],"key":"hiErMXKkJ3"}],"key":"MQh1o679TF"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Declining birth rates reducing working-age population","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"R7lytCjFZl"}],"key":"aCzhY6YCF9"}],"key":"n3s1xhns7V"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Increasing longevity extending retirement duration","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"VXDy97RiWm"}],"key":"WJvpZGfn0X"}],"key":"ycb5kckosU"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Shifting household composition patterns","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"Ctem2p1AdX"}],"key":"z3c4ngLMHL"}],"key":"AQwlDPNhvg"}],"key":"IxTxFgmRmA"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Traditional approaches typically sacrifice either economic sophistication (using simplified tax calculations) or demographic realism (holding age distributions constant). Our methodology preserves both.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"RZuJDfJudS"}],"key":"QxSG9yeRvL"},{"type":"heading","depth":2,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Running Projections","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"xhnCI3QgZc"}],"identifier":"running-projections","label":"Running Projections","html_id":"running-projections","implicit":true,"key":"s2s4afED5c"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Run projections using ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"KjinSDw0Cm"},{"type":"inlineCode","value":"run_household_projection.py","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"WwEZtH75Uc"},{"type":"text","value":":","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"LgYgPxGJp7"}],"key":"xOASNwBY83"},{"type":"code","lang":"bash","value":"# Save calibrated datasets as .h5 files for each year\npython ../policyengine_us_data/datasets/cps/long_term/run_household_projection.py 2027 --greg --use-ss --use-payroll --save-h5","position":{"start":{"line":30,"column":1},"end":{"line":33,"column":1}},"key":"bkf4BjnBGP"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"strong","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Arguments:","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"z79BIKTnvl"}],"key":"nu1VKMqkbP"}],"key":"t8uyTFBCx6"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"END_YEAR","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"n3g5uBucT4"},{"type":"text","value":": Target year for projection (default: 2035)","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"hktnpE6dE8"}],"key":"L5s7G2cpoP"}],"key":"koVssViaRS"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"--greg","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"Snh4DNQo66"},{"type":"text","value":": Use GREG calibration instead of IPF (optional)","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"QqGurxIiW2"}],"key":"XtRqe2XAw8"}],"key":"rhAISbtOyA"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"--use-ss","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"bt0RpWRktF"},{"type":"text","value":": Include Social Security benefit totals as calibration target (requires --greg)","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"Pwf5q3E7Yl"}],"key":"RLbySpsUAm"}],"key":"AjJ00mEezX"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"--use-payroll","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"rZgdKJ0QPr"},{"type":"text","value":": Include taxable payroll as calibration target (requires --greg)","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"mLYGxkIYHW"}],"key":"rXLSjv2v0f"}],"key":"yI51V3EFdj"},{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"--save-h5","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"F1KNn32yOC"},{"type":"text","value":": Save year-specific .h5 files to ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"Cz3R57dtaH"},{"type":"inlineCode","value":"./projected_datasets/","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"mS2vatmQ2f"},{"type":"text","value":" directory","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"x16b2KCYQy"}],"key":"BkLa23j11q"}],"key":"S4tfAMnuyi"}],"key":"BNUKNl1WUG"},{"type":"heading","depth":2,"position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Data Sources","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"KuWuvardrw"}],"identifier":"data-sources","label":"Data Sources","html_id":"data-sources","implicit":true,"key":"vkzPxtuuCS"},{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"The long-term projections use two key SSA datasets:","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"z9MkAKh9sg"}],"key":"uYVncfUSNB"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":46,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":46,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"strong","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"SSA Population Projections","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"K4HpcFXgXI"}],"key":"RnvAqYuwm6"},{"type":"text","value":" (","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"pJZlenN0Lu"},{"type":"inlineCode","value":"SSPopJul_TR2024.csv","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"QW6CKgL9PV"},{"type":"text","value":")","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"nZfNljH4mk"}],"key":"SxsCZZEE5G"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":47,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Source: ","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"Ctsmh5djjK"},{"type":"link","url":"https://www.ssa.gov/oact/HistEst/Population/2024/Population2024.html","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"SSA 2024 Trustees Report - Single Year Age Demographic Projections","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"NZRUdOQwiX"}],"urlSource":"https://www.ssa.gov/oact/HistEst/Population/2024/Population2024.html","key":"pZPPssPUbZ"}],"key":"nVYL1uWndC"}],"key":"ZWsodrt744"},{"type":"listItem","spread":true,"position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Contains age-specific population projections through 2100","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"bhq9JkaZEp"}],"key":"Zeuy55Wemd"}],"key":"uhd0wROrkN"},{"type":"listItem","spread":true,"position":{"start":{"line":49,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Used for demographic reweighting to match future population structure","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"KTSsxbwna6"}],"key":"JwSzTpSsv2"}],"key":"hPwumidxZ5"}],"key":"NviEiMNfsQ"}],"key":"i7VndnmaBt"},{"type":"listItem","spread":true,"position":{"start":{"line":51,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"strong","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"Social Security Cost Projections","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"YIZmP3KtJS"}],"key":"iW1cFRsoMe"},{"type":"text","value":" (","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"HRw1R3T1ip"},{"type":"inlineCode","value":"social_security_aux.csv","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"zVDhbQXq6x"},{"type":"text","value":")","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"RFl0RDtcC2"}],"key":"fsntOIu1y3"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":52,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Source: ","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"XwoV7SKBPd"},{"type":"link","url":"https://www.ssa.gov/oact/TR/2025/index.html","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"SSA 2025 Trustees Report, Table VI.G9","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"uw5ezSQyVs"}],"urlSource":"https://www.ssa.gov/oact/TR/2025/index.html","key":"m3yXpR9h4S"}],"key":"HryZ0Z3406"}],"key":"YisfLwbm2l"},{"type":"listItem","spread":true,"position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Contains OASDI benefit cost projections in CPI-indexed 2025 dollars","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"GRr1gRxjmp"}],"key":"rAY1NTTca6"}],"key":"LgEpElK2vG"},{"type":"listItem","spread":true,"position":{"start":{"line":54,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Used as calibration target in GREG method to ensure fiscal consistency","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"AqgdJXLzfR"}],"key":"S8YQE8yadH"}],"key":"gcQg0woy7w"}],"key":"GcrEjhNaaV"}],"key":"evtOixks0c"}],"key":"RgGuYsXFR7"},{"type":"heading","depth":3,"position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"Loading SSA Data","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"hXbeFf53A8"}],"identifier":"loading-ssa-data","label":"Loading SSA Data","html_id":"loading-ssa-data","implicit":true,"key":"Aopu6qfBD6"},{"type":"code","lang":"python","value":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom pathlib import Path\n\nfrom policyengine_us_data.storage import STORAGE_FOLDER\n\n# Load SSA population data\nssa_pop = pd.read_csv(STORAGE_FOLDER / 'SSPopJul_TR2024.csv')\nssa_pop.head()\n\n# Load Social Security auxiliary data\nss_aux = pd.read_csv(STORAGE_FOLDER / 'social_security_aux.csv')\nss_aux.head()","position":{"start":{"line":58,"column":1},"end":{"line":73,"column":1}},"key":"Do1xYnNG6O"},{"type":"heading","depth":2,"position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"Core Innovation","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"eERYiucbpU"}],"identifier":"core-innovation","label":"Core Innovation","html_id":"core-innovation","implicit":true,"key":"kPUSopUh3t"},{"type":"paragraph","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"Our approach operates in two complementary stages:","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"qdLYCjTrDs"}],"key":"sNOHqnacsa"},{"type":"heading","depth":3,"position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"text","value":"Stage 1: Economic Uprating","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"HFd3VMfDhC"}],"identifier":"stage-1-economic-uprating","label":"Stage 1: Economic Uprating","html_id":"stage-1-economic-uprating","implicit":true,"key":"VfymULyKpQ"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"PolicyEngine’s microsimulation engine projects each household’s economic circumstances forward using:","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"gI5eSbVqAm"}],"key":"bVWjJnkVZz"},{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"strong","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"Sophisticated Income Modeling","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"nSSEbLWUXj"}],"key":"Y1DXVLlLk0"}],"key":"JldGpQDp25"},{"type":"paragraph","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"text","value":"The system models 17 distinct income categories, each uprated according to its economic fundamentals:","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"P6QJHSsM4j"}],"key":"yyrNH9F1lM"},{"type":"paragraph","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"Primary Categories with Specific Projections:","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"YAeWgMzZ7Q"}],"key":"rBE8aMFgLn"}],"key":"soew6VFblH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":88,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Employment income (wages) - follows CBO wage growth projections","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"O8rBnH40VC"}],"key":"CFGCIkidAi"}],"key":"zbo4H4DODe"},{"type":"listItem","spread":true,"position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Self-employment income - follows CBO business income projections","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"aWcwko7ZgP"}],"key":"OI4ebx9yIl"}],"key":"lutaklPnQz"},{"type":"listItem","spread":true,"position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Capital gains - follows CBO asset appreciation projections","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"Gxt1OYY4Wr"}],"key":"hT1EvDejWI"}],"key":"vlIT7sKIDO"},{"type":"listItem","spread":true,"position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Interest income - follows CBO interest rate projections","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"HPBga2BHnt"}],"key":"kwkDIUBThR"}],"key":"aOSFoi1CyF"},{"type":"listItem","spread":true,"position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Dividend income - follows CBO corporate profit projections","position":{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},"key":"DainiNjknB"}],"key":"bLopjfKGtu"}],"key":"OC1LyuIedK"},{"type":"listItem","spread":true,"position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Pension income - follows CBO retirement income projections","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"CJ8QJR9aLo"}],"key":"hNdykFe7RT"}],"key":"EQKuwN1LWK"},{"type":"listItem","spread":true,"position":{"start":{"line":94,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Social Security - follows SSA COLA projections (available through 2100)","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"key":"p6sZVZwzp9"}],"key":"sZYanq5dxh"}],"key":"P0EAYUeRj7"}],"key":"uuMb6H6wGW"},{"type":"heading","depth":3,"position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"children":[{"type":"text","value":"Stage 2: Demographic Reweighting","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"zEHmGcugyN"}],"identifier":"stage-2-demographic-reweighting","label":"Stage 2: Demographic Reweighting","html_id":"stage-2-demographic-reweighting","implicit":true,"key":"xKN7yOALU3"},{"type":"paragraph","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"We offer two calibration methods for adjusting household weights to match SSA projections:","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"THgQNLTnO6"}],"key":"M1E6oIEKAK"},{"type":"paragraph","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"strong","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"Method 1: Iterative Proportional Fitting (IPF)","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"nH6Nt3pV6U"}],"key":"oAdDUaGNDB"}],"key":"OBg33yGMkc"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":101,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Traditional raking approach using Kullback-Leibler divergence","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"YlTnOVeVu9"}],"key":"FjCxc3SPTc"}],"key":"t80QoPzmXz"},{"type":"listItem","spread":true,"position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Iteratively adjusts weights to match marginal distributions","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"FWlsVkbOLA"}],"key":"nSe2aT3Ja4"}],"key":"eXJ77FZyul"},{"type":"listItem","spread":true,"position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Robust to specification and always produces non-negative weights","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"NOtdwnFpxC"}],"key":"g43nbiVeKA"}],"key":"FKHyP4NJxJ"},{"type":"listItem","spread":true,"position":{"start":{"line":104,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Default method for backward compatibility","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"wONkLoNgUO"}],"key":"Cvs0EjSp0v"}],"key":"cEFq4KMIjK"}],"key":"A3sUIeZ6yy"},{"type":"paragraph","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"strong","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"text","value":"Method 2: Generalized Regression (GREG) Calibration","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"ZKxds9D5uX"}],"key":"pzsav8NjcH"}],"key":"rVwyHPGqPT"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":107,"column":1},"end":{"line":111,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Modern calibration using chi-squared distance minimization","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"wEjmFiZDuW"}],"key":"yRIyx3qGZD"}],"key":"eFtiAZ2ffB"},{"type":"listItem","spread":true,"position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Enables simultaneous calibration to categorical AND continuous variables","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"qwK8rr7J0G"}],"key":"nQ1fFZ7sF4"}],"key":"sHjUHlXOAK"},{"type":"listItem","spread":true,"position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Direct solution via matrix operations (no iteration needed)","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"Su7aevxQ9e"}],"key":"FsTG7aFce0"}],"key":"iOmdtv6Vdi"},{"type":"listItem","spread":true,"position":{"start":{"line":110,"column":1},"end":{"line":111,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Required for incorporating Social Security benefit constraints","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"CaUekrzx8d"}],"key":"Rk10nYMuPD"}],"key":"Es7YoVkdrH"}],"key":"f2giAgXFaB"},{"type":"heading","depth":2,"position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"children":[{"type":"text","value":"Demonstrating the Calibration Methods","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"key":"dqS6ZOYC1m"}],"identifier":"demonstrating-the-calibration-methods","label":"Demonstrating the Calibration Methods","html_id":"demonstrating-the-calibration-methods","implicit":true,"key":"BjFLy85ig7"},{"type":"code","lang":"python","value":"from policyengine_us_data.datasets.cps.long_term.ssa_data import (\n    load_ssa_age_projections,\n    load_ssa_benefit_projections\n)\n\n# Get SSA population targets for a specific year\nyear = 2025\nage_targets = load_ssa_age_projections(end_year=year)\nprint(f\"\\nAge distribution targets for {year}:\")\nprint(f\"Shape: {age_targets.shape}\")\nprint(f\"Total population: {age_targets[:, 0].sum() / 1000:.1f}M\")\n\n# Get Social Security benefit target\nss_target = load_ssa_benefit_projections(year)\nprint(f\"\\nSocial Security benefit target for {year}: ${ss_target / 1e9:.1f}B\")","position":{"start":{"line":114,"column":1},"end":{"line":130,"column":1}},"key":"BzP7ZuSDjc"},{"type":"heading","depth":2,"position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"children":[{"type":"text","value":"PWBM Analysis: Eliminating Income Taxes on Social Security Benefits","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"key":"Hj17aYHSna"}],"identifier":"pwbm-analysis-eliminating-income-taxes-on-social-security-benefits","label":"PWBM Analysis: Eliminating Income Taxes on Social Security Benefits","html_id":"pwbm-analysis-eliminating-income-taxes-on-social-security-benefits","implicit":true,"key":"LiKvRdPW1s"},{"type":"paragraph","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"strong","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"text","value":"Source:","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"IWEgDEFTiI"}],"key":"vgkiyxK4GN"},{"type":"text","value":" ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"GfcHwZkqZp"},{"type":"link","url":"https://budgetmodel.wharton.upenn.edu/issues/2025/2/10/eliminating-income-taxes-on-social-security-benefits","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"text","value":"Eliminating Income Taxes on Social Security Benefits","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"HwsazFXhtl"}],"urlSource":"https://budgetmodel.wharton.upenn.edu/issues/2025/2/10/eliminating-income-taxes-on-social-security-benefits","key":"ObgH92YRHY"},{"type":"text","value":" (Penn Wharton Budget Model, February 10, 2025)","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"D9bH8eQi96"}],"key":"tIWafukoTw"},{"type":"thematicBreak","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"RVvsebinON"},{"type":"heading","depth":3,"position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"children":[{"type":"text","value":"Policy Analyzed","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"key":"B4T9L2Tgh1"}],"identifier":"policy-analyzed","label":"Policy Analyzed","html_id":"policy-analyzed","implicit":true,"key":"VFflBbFOyQ"},{"type":"paragraph","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"children":[{"type":"text","value":"The Penn Wharton Budget Model (PWBM) analyzed a policy proposal to permanently eliminate all income taxes on Social Security benefits, effective January 1, 2025.","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"key":"VeRicedIbu"}],"key":"CmXYdaFPrD"},{"type":"heading","depth":3,"position":{"start":{"line":141,"column":1},"end":{"line":141,"column":1}},"children":[{"type":"text","value":"Key Findings","position":{"start":{"line":141,"column":1},"end":{"line":141,"column":1}},"key":"RrO7FxzlVx"}],"identifier":"key-findings","label":"Key Findings","html_id":"key-findings","implicit":true,"key":"xRTpymiqbL"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":143,"column":1},"end":{"line":158,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":143,"column":1},"end":{"line":144,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"children":[{"type":"strong","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"children":[{"type":"text","value":"Budgetary Impact:","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"key":"r9SwCILnL0"}],"key":"jGtouu5OyY"},{"type":"text","value":" The policy is projected to reduce federal revenues by ","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"key":"bJFaFHZZ5a"},{"type":"strong","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"children":[{"type":"text","value":"$1.45 trillion","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"key":"Wmq8JeW3sc"}],"key":"oCxcuIljFZ"},{"type":"text","value":" over the 10-year budget window (2025-2034). Over the long term, it is projected to increase federal debt by 7 percent by 2054, relative to the current baseline.","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"key":"G7tFDuQrAk"}],"key":"DeAQQf6JUO"}],"key":"dtXZ2fbkch"},{"type":"listItem","spread":true,"position":{"start":{"line":145,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"children":[{"type":"strong","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"children":[{"type":"text","value":"Macroeconomic Impact:","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"Mg9CpZvzyp"}],"key":"XckYBAxX7M"},{"type":"text","value":" The analysis finds the policy would have negative long-term effects on the economy.","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"ryNpAqq2xd"}],"key":"JVFpYvV69F"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":146,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It reduces incentives for households to save for retirement and to work.","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"b2D8FE0jH2"}],"key":"l9HnSMFHUr"}],"key":"Lqck9pxgdh"},{"type":"listItem","spread":true,"position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This leads to a smaller capital stock (projected to be 4.2% lower by 2054).","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"dzG55mXEu3"}],"key":"pqwTbHfJQU"}],"key":"VqUyjNqWEk"},{"type":"listItem","spread":true,"position":{"start":{"line":148,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The smaller capital stock results in lower average wages (1.8% lower by 2054) and lower GDP (2.1% lower by 2054).","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"TxgVfjx6sk"}],"key":"KjtlVjPrTV"}],"key":"RConuS5HlG"}],"key":"j1GZBUrVkz"}],"key":"nH1Buz2n8P"},{"type":"listItem","spread":true,"position":{"start":{"line":150,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"strong","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"Conventional Distributional Impact (Your Table):","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"YKax8iaNGh"}],"key":"KwXV0BuNjb"},{"type":"text","value":" The table you shared shows the annual “conventional” effects on household after-tax income.","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"pNAkKEEvxA"}],"key":"kckp6fknx2"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":151,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The largest average ","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"z9QnPR56OD"},{"type":"emphasis","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"dollar","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"IQWBf6TKDN"}],"key":"Mw5orLpBYv"},{"type":"text","value":" tax cuts go to households in the top 20 percent of the income distribution (quintiles 80-100%).","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"jQbHLQNtRr"}],"key":"UnjxXP43GU"}],"key":"PCZ0dpnDf2"},{"type":"listItem","spread":true,"position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The largest ","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"tv8CwFxsPg"},{"type":"emphasis","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"children":[{"type":"text","value":"relative","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"YRzSWQjbhy"}],"key":"TO8B1Re0E2"},{"type":"text","value":" gains (as a percentage of income) go to households in the fourth quintile (60-80%), who see a 1.6% increase in after-tax income by 2054.","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"kr7IrcLPsT"}],"key":"nZCZK1dMKA"}],"key":"FGKKKpkNWr"},{"type":"listItem","spread":true,"position":{"start":{"line":153,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The dollar amounts shown are in ","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"Jag617J9OF"},{"type":"strong","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"children":[{"type":"text","value":"nominal dollars","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"vMdCGqlzKn"}],"key":"G5rwrZamyx"},{"type":"text","value":" for each specified year, not adjusted to a single base year.","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"tTceIUhlwJ"}],"key":"bEkYrHr4cg"}],"key":"Hs3uZlx6fR"}],"key":"SukiyAQdTS"}],"key":"SrjQ0drSXz"},{"type":"listItem","spread":true,"position":{"start":{"line":155,"column":1},"end":{"line":158,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"children":[{"type":"strong","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"children":[{"type":"text","value":"Dynamic (Lifetime) Impact:","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"key":"Np3A3VlhSf"}],"key":"aTMqILpKTv"},{"type":"text","value":" When analyzing the policy’s effects over a household’s entire lifetime, PWBM finds:","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"key":"fwsMl3iWVY"}],"key":"vzIDAD4C8R"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":156,"column":1},"end":{"line":158,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The policy primarily benefits high-income households who are nearing or in retirement.","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"VQOoE4klMr"}],"key":"BKh3LC89FQ"}],"key":"Zw8bNSZkf8"},{"type":"listItem","spread":true,"position":{"start":{"line":157,"column":1},"end":{"line":158,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It negatively impacts all households under the age of 30 and all future generations, who would experience a net welfare loss due to the long-term effects of lower wages and higher federal debt.","position":{"start":{"line":157,"column":1},"end":{"line":157,"column":1}},"key":"y8SYpwEDfg"}],"key":"AiEgdFlroZ"}],"key":"Wp7MU2arDy"}],"key":"SuKTPvNrRg"}],"key":"lTbYvnO0wL"}],"key":"xuUcz5aLWW"},{"type":"heading","depth":2,"position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"children":[{"type":"text","value":"PolicyEngine’s Analysis of Eliminating Income Taxes on Social Security Benefits","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"key":"NS1MHc9Ypx"}],"identifier":"policyengines-analysis-of-eliminating-income-taxes-on-social-security-benefits","label":"PolicyEngine’s Analysis of Eliminating Income Taxes on Social Security Benefits","html_id":"policyengines-analysis-of-eliminating-income-taxes-on-social-security-benefits","implicit":true,"key":"PubJYVsMLD"},{"type":"code","lang":"python","value":"import sys\nimport os\nimport pandas as pd\nimport numpy as np\nimport gc\n\nfrom policyengine_us import Microsimulation\nfrom policyengine_core.reforms import Reform\n\nWHARTON_BENCHMARKS = {\n    2026: {\n        'First quintile': {'tax_change': 0, 'pct_change': 0.0},\n        'Second quintile': {'tax_change': -15, 'pct_change': 0.0},\n        'Middle quintile': {'tax_change': -340, 'pct_change': 0.5},\n        'Fourth quintile': {'tax_change': -1135, 'pct_change': 1.1},\n        '80-90%': {'tax_change': -1625, 'pct_change': 1.0},\n        '90-95%': {'tax_change': -1590, 'pct_change': 0.7},\n        '95-99%': {'tax_change': -2020, 'pct_change': 0.5},\n        '99-99.9%': {'tax_change': -2205, 'pct_change': 0.2},\n        'Top 0.1%': {'tax_change': -2450, 'pct_change': 0.0},\n    },\n    2034: {\n        'First quintile': {'tax_change': 0, 'pct_change': 0.0},\n        'Second quintile': {'tax_change': -45, 'pct_change': 0.1},\n        'Middle quintile': {'tax_change': -615, 'pct_change': 0.8},\n        'Fourth quintile': {'tax_change': -1630, 'pct_change': 1.2},\n        '80-90%': {'tax_change': -2160, 'pct_change': 1.1},\n        '90-95%': {'tax_change': -2160, 'pct_change': 0.7},\n        '95-99%': {'tax_change': -2605, 'pct_change': 0.6},\n        '99-99.9%': {'tax_change': -2715, 'pct_change': 0.2},\n        'Top 0.1%': {'tax_change': -2970, 'pct_change': 0.0},\n    },\n    2054: {\n        'First quintile': {'tax_change': -5, 'pct_change': 0.0},\n        'Second quintile': {'tax_change': -275, 'pct_change': 0.3},\n        'Middle quintile': {'tax_change': -1730, 'pct_change': 1.3},\n        'Fourth quintile': {'tax_change': -3560, 'pct_change': 1.6},\n        '80-90%': {'tax_change': -4075, 'pct_change': 1.2},\n        '90-95%': {'tax_change': -4385, 'pct_change': 0.9},\n        '95-99%': {'tax_change': -4565, 'pct_change': 0.6},\n        '99-99.9%': {'tax_change': -4820, 'pct_change': 0.2},\n        'Top 0.1%': {'tax_change': -5080, 'pct_change': 0.0},\n    },\n}\n\ndef run_analysis(dataset_path, year, income_rank_var = \"household_net_income\"):\n    \"\"\"Run Option 1 analysis for given dataset and year\"\"\"\n\n    option1_reform = Reform.from_dict(\n        {\n            # Base rate parameters (0-50% bracket)\n            \"gov.irs.social_security.taxability.rate.base.benefit_cap\": {\n                \"2026-01-01.2100-12-31\": 0\n            },\n            \"gov.irs.social_security.taxability.rate.base.excess\": {\n                \"2026-01-01.2100-12-31\": 0\n            },\n            # Additional rate parameters (50-85% bracket)\n            \"gov.irs.social_security.taxability.rate.additional.benefit_cap\": {\n                \"2026-01-01.2100-12-31\": 0\n            },\n            \"gov.irs.social_security.taxability.rate.additional.bracket\": {\n                \"2026-01-01.2100-12-31\": 0\n            },\n            \"gov.irs.social_security.taxability.rate.additional.excess\": {\n                \"2026-01-01.2100-12-31\": 0\n            }\n        }, country_id=\"us\"\n    )\n    reform = Microsimulation(dataset=dataset_path, reform=option1_reform)\n\n    # Get household data\n    household_net_income_reform = reform.calculate(\"household_net_income\", period=year, map_to=\"household\")\n    household_agi_reform = reform.calculate(\"adjusted_gross_income\", period=year, map_to=\"household\")\n    income_tax_reform = reform.calculate(\"income_tax\", period=year, map_to=\"household\")\n\n    del reform\n    gc.collect()\n\n    print(f\"Loading dataset: {dataset_path}\")\n    baseline = Microsimulation(dataset=dataset_path)\n    household_weight = baseline.calculate(\"household_weight\", period=year)\n    household_net_income_baseline = baseline.calculate(\"household_net_income\", period=year, map_to=\"household\")\n    household_agi_baseline = baseline.calculate(\"adjusted_gross_income\", period=year, map_to=\"household\")\n    income_tax_baseline = baseline.calculate(\"income_tax\", period=year, map_to=\"household\")\n\n    # Calculate changes\n    tax_change = income_tax_reform - income_tax_baseline\n    income_change_pct = (\n        (household_net_income_reform - household_net_income_baseline) / household_net_income_baseline\n    ) * 100\n\n    # Create DataFrame\n    df = pd.DataFrame({\n        'household_net_income': household_net_income_baseline,\n        'weight': household_weight,\n        'tax_change': tax_change,\n        'income_change_pct': income_change_pct,\n        'income_rank_var': baseline.calculate(income_rank_var, year, map_to=\"household\")\n    })\n\n    # Calculate percentiles\n\n    print(f\"Ranking according to quantiles with: {income_rank_var}\")\n    df['income_percentile'] = df['income_rank_var'].rank(pct=True) * 100\n\n    # Assign income groups\n    def assign_income_group(percentile):\n        if percentile <= 20:\n            return 'First quintile'\n        elif percentile <= 40:\n            return 'Second quintile'\n        elif percentile <= 60:\n            return 'Middle quintile'\n        elif percentile <= 80:\n            return 'Fourth quintile'\n        elif percentile <= 90:\n            return '80-90%'\n        elif percentile <= 95:\n            return '90-95%'\n        elif percentile <= 99:\n            return '95-99%'\n        elif percentile <= 99.9:\n            return '99-99.9%'\n        else:\n            return 'Top 0.1%'\n\n    df['income_group'] = df['income_percentile'].apply(assign_income_group)\n\n    # Calculate aggregate revenue\n    revenue_impact = (income_tax_reform.sum() - income_tax_baseline.sum()) / 1e9\n\n    # Calculate by group\n    results = []\n    for group in ['First quintile', 'Second quintile', 'Middle quintile', 'Fourth quintile',\n                  '80-90%', '90-95%', '95-99%', '99-99.9%', 'Top 0.1%']:\n        group_data = df[df['income_group'] == group]\n        if len(group_data) == 0:\n            continue\n\n        total_weight = group_data['weight'].sum()\n        avg_tax_change = (group_data['tax_change'] * group_data['weight']).sum() / total_weight\n        avg_income_change_pct = (group_data['income_change_pct'] * group_data['weight']).sum() / total_weight\n\n        results.append({\n            'group': group,\n            'pe_tax_change': round(avg_tax_change),\n            'pe_pct_change': round(avg_income_change_pct, 1),\n        })\n\n    return pd.DataFrame(results), revenue_impact\n\ndef generate_comparison_table(pe_results, year):\n    \"\"\"Generate comparison table with Wharton benchmark\"\"\"\n\n    if year not in WHARTON_BENCHMARKS:\n        print(f\"Warning: No Wharton benchmark available for year {year}\")\n        return pe_results\n\n    wharton_data = WHARTON_BENCHMARKS[year]\n\n    comparison = []\n    for _, row in pe_results.iterrows():\n        group = row['group']\n        wharton = wharton_data.get(group, {'tax_change': None, 'pct_change': None})\n\n        pe_tax = row['pe_tax_change']\n        wh_tax = wharton['tax_change']\n\n        comparison.append({\n            'Income Group': group,\n            'PolicyEngine': f\"${pe_tax:,}\",\n            'Wharton': f\"${wh_tax:,}\" if wh_tax is not None else 'N/A',\n            'Difference': f\"${(pe_tax - wh_tax):,}\" if wh_tax is not None else 'N/A',\n            'PE %': f\"{row['pe_pct_change']}%\",\n            'Wharton %': f\"{wharton['pct_change']}%\" if wharton['pct_change'] is not None else 'N/A',\n        })\n\n    return pd.DataFrame(comparison)\n\n# Example usage:\n# dataset_path = 'hf://policyengine/test/2054.h5'\n# year = 2054\n# income_rank_variable = \"household_net_income\"\n# pe_results, revenue_impact = run_analysis(dataset_path, year, income_rank_variable)\n# comparison_table = generate_comparison_table(pe_results, year)","position":{"start":{"line":161,"column":1},"end":{"line":348,"column":1}},"key":"dNpxTt3CAc"}],"key":"WRujvD3Jm5"}],"key":"WQNkSNw0Bm"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Methodology","url":"/methodology","group":"PolicyEngine US Data"},"next":{"title":"Local Area Calibration Setup","url":"/local-area-calibration-setup","group":"PolicyEngine US Data"}}},"domain":"http://localhost:3000"}